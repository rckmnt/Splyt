<html>
	<head>
		<title> Splyt UI </title>
		<style>
			body { margin: 0; background-color: #ffffff }
			canvas { width: 100%; height: 100%; color: #ffffff}
		</style>
	</head>
	<body>
		<script src="js/three.min.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/dat.gui.js"></script>
		<script src="js/JSONLoader.js"></script>
		<script src="js/BinaryLoader.js"></script>
		<script>

			(function() {
				if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

				var scene, camera, controls, renderer, materials;
				var pi = 3.14159;
				Math.radians = function(degrees) { return degrees * Math.PI / 180; };

				init();
				render();
				animate();

				function init(){

					scene = new THREE.Scene();

					// Camera

					camera = new THREE.PerspectiveCamera( 55, window.innerWidth/window.innerHeight, 0.1, 1000 );
					camera.position.x = 10;
					camera.position.y = 15;
					camera.position.z = 15;

					controls = new THREE.OrbitControls(camera);
					controls.addEventListener('change', render);

					renderer = new THREE.WebGLRenderer();
					renderer.setClearColor(0xffffff, 1);
					renderer.shadowMapEnabled = true;
					renderer.setSize( window.innerWidth, window.innerHeight );
					document.body.appendChild( renderer.domElement );

					var axisHelper = new THREE.AxisHelper( 5 );
					scene.add( axisHelper );

					// GUIpanel
					/*
					var GUIpanel = new function() {
						this.rotation = 5;
						this.Ypos = 3;
						}

					var gui = new dat.GUI();
					var bHeightController = gui.add(GUIpanel, 'bHeight', 0, 10);
					var yPosController = gui.add(GUIpanel, 'Ypos', 0, 5);
					*/

					// bHeightController.onChange(function(value) {
					// 	scene.remove(scene.getObjectByName('splyt'));
					// 	var newMesh = createSplytCylinders('splyt', {
					// 		radius: 0.5,
					// 		baseHeight: value
					// 	});
					// 	scene.add(newMesh);
					// 	render();
					// });


					// Ground plane

					var planeGeometry = new THREE.PlaneGeometry(10,10,1,1);
					var planeMaterial = new THREE.MeshLambertMaterial({color: 0xffffff, transparent: true, opacity: 0.7, side: THREE.DoubleSide});
					var plane = new THREE.Mesh(planeGeometry,planeMaterial);
					plane.receiveShadow  = true;
					plane.rotation.x= -0.5 * Math.PI;
					plane.position.set( 0, 0, 0 )
					scene.add(plane);

					// Lights

					light = new THREE.DirectionalLight( 0xffffff );
					light.position.set( 10, 10, 10 );
					scene.add(light);

					light = new THREE.DirectionalLight( 0xffffff );
					light.position.set( -10, -10, -10 );
					scene.add(light);

					light = new THREE.AmbientLight( 0x222222 );
					scene.add(light);

					//scene.add(createSplytLine());  // skeleton wireframe
					scene.add(createSplytCylinders());

				}


				// Geometry

				function createSplytLine(){

					var skeleton = new THREE.Geometry();
					skeleton.vertices.push(
							new THREE.Vector3(0, 0, 0),
							new THREE.Vector3(0, 5, 0),
							new THREE.Vector3(3, 8, 0),
							new THREE.Vector3(0, 5, 0),
							new THREE.Vector3(-3, 8, 0)
					);

					var lineMaterial = new THREE.LineBasicMaterial({color: 0x0000ff});

					var extrudeSettings = {
							steps	: 200,
							bevelEnabled	: false,
							extrudePath		: skeleton
					};

					var pline = new THREE.Line(skeleton, lineMaterial);
					return pline;
				}

				function createSplytCylinders(rotation) {

					var r = 0.5;
					var bHeight = 5;
					var armLength = 4;

					var base = new THREE.CylinderGeometry(r, r, bHeight, 24, 8, false);
					base.translate(0, bHeight/2, 0);

					var rArm = new THREE.CylinderGeometry(r, r, armLength, 24, 8, false);
					rArm.rotateZ(-Math.radians(45));
					rArm.translate(1.4, bHeight + 1.375, 0);

					var lArm = new THREE.CylinderGeometry(r, r, armLength, 24, 8, false);
					var moveVec = new THREE.Vector3( 1, 1, 0);
					lArm.rotateZ( Math.radians(45) );
					lArm.translate(-1.4, bHeight + 1.375, 0);


					var materials = [
						new THREE.MeshLambertMaterial( { color:  0xFFF9DC, shading: THREE.SmoothShading } )
						//new THREE.MeshBasicMaterial( { color: 0x000000, wireframe: true , transparent: true, opacity: 0.1} )
					];

					var smallYGeo = new THREE.Geometry();
					smallYGeo.merge(base, base.matrix);
					smallYGeo.merge(rArm, rArm.matrix);
					smallYGeo.merge(lArm, lArm.matrix);
					smallYGeo.rotateY(Math.radians( 180 * Math.random() ));

					var smallYMesh = new THREE.SceneUtils.createMultiMaterialObject(smallYGeo, materials);
					smallYMesh.name = name;
					return smallYMesh;
				};

				// load BULB

				var loader = new THREE.JSONLoader();
				loader.load(
					'models/bulb_custom.js',
					function ( geometry, materials ) {
						var material = new THREE.MultiMaterial( materials );
						var bulb = new THREE.Mesh( geometry, material );
						bulb.position.set(0, 10, 0);
						scene.add( bulb );
					}
				);

				// Render

				function render() {
					renderer.render(scene, camera);
				}

				function animate(){
					requestAnimationFrame( render );
					controls.update();
				}

				function onWindowResize() {
					var windowHalfX = window.innerWidth / 2;
					var windowHalfY = window.innerHeight / 2;

					camera.aspect = window.innerWidth / window.innerHeight;
					camera.updateProjectionMatrix();

					renderer.setSize( window.innerWidth, window.innerHeight );
				}

				render();
			}());
		</script>
	</body>
</html>
